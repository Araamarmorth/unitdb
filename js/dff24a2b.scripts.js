"use strict";function getAttribute(a,b){var c=a;for(var d in b)if(c=c[b[d]],void 0===c)return null;return c}function extractContentFromBP(a){var b={};for(var c in representationExtractionTable){var d=representationExtractionTable[c][0],e={},f=!1;for(var g in representationExtractionTable[c][1]){var h=representationExtractionTable[c][1][g][0],i=representationExtractionTable[c][1][g][1],j=representationExtractionTable[c][1][g][2],k=representationExtractionTable[c][1][g][3],l=getAttribute(a,h);null!==l&&(e[i]=[l+j,k],f=!0)}f&&(b[d]=[["",e]])}return b}!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}();var unitDb=function(){var a=function(a,c){var d=b(a,c);return angular.bootstrap(document,[a]),d},b=function(a,b){var c=angular.module(a,["ngRoute","ngSanitize","angular-underscore","ngDraggable"]);return c.config(["$routeProvider",function(a){a.when("/",{controller:"homeCtrl",templateUrl:"views/home.html"}).when("/:ids",{controller:"compareCtrl",templateUrl:"views/compare.html"}).otherwise({templateUrl:"404.html"})}]),c.provider("data",unitDb.services.dataProvider),c.config(["dataProvider",function(a){if(!b)throw"need unit data!";a.setIndex(b)}]),angular.forEach(unitDb.filters,function(a,b){c.filter(b,a)}),angular.forEach(unitDb.directives,function(a,b){c.directive(b,a)}),angular.forEach(unitDb.controllers,function(a,b){c.controller(b,a)}),c};return{start:a}}();unitDb=unitDb||{},unitDb.DpsCalculator={next:null,canCalculate:function(){return!1},_dps:function(){},rateInverse:function(a){return Math.round(10/a.RateOfFire)/10},dps:function(a){return this.canCalculate(a)?this._dps(a):this.next&&this.next.dps?this.next.dps(a):void 0}},unitDb.DefaultDpsCalculator=angular.extend({},unitDb.DpsCalculator,{canCalculate:function(){return!0},_dps:function(a){var b=1,c={"/projectiles/TIFFragmentationSensorShell01/TIFFragmentationSensorShell01_proj.bp":4,"/projectiles/SIFThunthoArtilleryShell01/SIFThunthoArtilleryShell01_proj.bp":5};return a.ProjectileId&&(b=c[a.ProjectileId]||1),b*a.Damage*a.MuzzleSalvoSize/unitDb.DpsCalculator.rateInverse(a)}}),unitDb.BeamDpsCalculator=angular.extend({},unitDb.DpsCalculator,{next:unitDb.DefaultDpsCalculator,canCalculate:function(a){return a.BeamLifetime},_dps:function(a){return a.Damage*a.BeamLifetime*(a.BeamCollisionDelay||1)*10/unitDb.DpsCalculator.rateInverse(a)}}),unitDb.ContinousBeamDpsCalculator=angular.extend({},unitDb.DpsCalculator,{next:unitDb.BeamDpsCalculator,canCalculate:function(a){return a.ContinuousBeam},_dps:function(a){return 10*a.Damage/(0===a.BeamCollisionDelay?1:2)}}),unitDb.DoTDpsCalculator=angular.extend({},unitDb.DpsCalculator,{next:unitDb.ContinousBeamDpsCalculator,canCalculate:function(a){return a.DoTPulses},_dps:function(a){var b=unitDb.DefaultDpsCalculator._dps(a);return(b+a.Damage*a.DoTPulses*a.MuzzleSalvoSize)/unitDb.DpsCalculator.rateInverse(a)}}),unitDb.dpsCalculator=unitDb.DoTDpsCalculator,unitDb=unitDb||{};var representationExtractionTable=[["Economy",[[["Economy","BuildCostMass"],"Mass cost"," m","mass units"],[["Economy","BuildCostEnergy"],"Energy cost"," e","energy units"],[["Economy","BuildTime"],"Time cost"," s","seconds"],[["Economy","BuildRate"],"Build rate","","dimensionless"],[["Economy","StorageMass"],"Mass storage"," m","mass units"],[["Economy","StorageEnergy"],"Energy storage"," e","energy units"],[["Economy","ProductionPerSecondMass"],"Mass yield"," m/s","mass units per second"],[["Economy","ProductionPerSecondEnergy"],"Energy yield"," e/s","energy units per second"],[["Economy","MaintenanceConsumptionPerSecondEnergy"],"Energy drain"," e/s","energy units per second"]]],["Defense",[[["Defense","Health"],"Health"," hp","hitpoints"],[["Defense","RegenRate"],"Regen rate"," hp/s","hitpoints per second"],[["Defense","Shield","ShieldMaxHealth"],"Shield health","hp","hitpoints"],[["Defense","Shield","ShieldRegenRate"],"Shield regen rate"," hp/s","hitpoints per second"],[["Defense","Shield","ShieldSize"],"Shield size"," d","distance units"]]],["Intel",[[["Intel","VisionRadius"],"Vision radius"," d","distance units"],[["Intel","RadarRadius"],"Radar radius"," d","distance units"],[["Intel","SonarRadius"],"Sonar radius"," d","distance units"]]],["Physics",[[["Physics","MaxSpeed"],"Max speed"," d/s","distance units per second"],[["Physics","TurnRate"],"Turn rate"," ?","?"],[["Physics","FuelUseTime"],"Fuel use time"," s","seconds"]]],["Air Physics",[[["Physics","Elevation"],"Elevation"," d","?"],[["Air","EngageDistance"],"Engage distance"," d","distance units"],[["Air","TurnSpeed"],"Turn speed"," s-1","hertz"],[["Air","CombatTurnSpeed"],"Combat turn speed"," s-1","hertz"]]]];unitDb.UnitDecorator=function(a){function b(a){var b=_.intersection(a.Categories,_.keys(h));return 1===b.length?h[b[0]]:""}function c(a){return(a.name?a.name+": ":"")+("EXP"===a.tech?"":a.tech+" ")+a.description}function d(a){var b=a.ManualFire?1:a.MuzzleSalvoSize,c=a.RateOfFire,d=a.RackSalvoChargeTime||0+a.RackSalvoReloadTime||0,e=1/c+d,f=a.Damage;return{shots:b,cycle:e,damage:f}}function e(a){var b=d(a);return b.shots+" shot"+(b.shots>1?"s":"")+" / "+(1===b.cycle?"":Math.round(10*b.cycle)/10)+" sec"}function f(a){return unitDb.dpsCalculator.dps(a)}var g={RULEUC_Engineer:"Build",RULEUC_Commander:"Build",RULEUMT_Amphibious:"Land",RULEUC_MilitaryVehicle:"Land",RULEUC_MilitaryAircraft:"Air",RULEUC_MilitarySub:"Naval",RULEUC_MilitaryShip:"Naval",RULEUC_Weapon:"Base",RULEUC_Sensor:"Base",RULEUC_Factory:"Base",RULEUC_Resource:"Base",RULEUC_MiscSupport:"Base",RULEUC_CounterMeasure:"Base"},h={RULEUTL_Basic:"T1",RULEUTL_Advanced:"T2",RULEUTL_Secret:"T3",RULEUTL_Experimental:"TX",TECH1:"T1",TECH2:"T2",TECH3:"T3",EXPERIMENTAL:"EXP"},i={id:a.Id,content:extractContentFromBP(a),blueprint:a,name:a.General.UnitName,description:a.Description,faction:a.General.FactionName,classification:g[a.General.Classification],tech:b(a),strategicIcon:a.StrategicIconName,icon:a.General.Icon||"",order:a.BuildIconSortPriority||1e3,fireCycle:e};i.fullName=c(i);for(var j in a.Weapon)_.extend(a.Weapon[j],{dps:f(a.Weapon[j])});return _.extend(i,a)},unitDb.services={dataProvider:function(){var a=[];this.setIndex=function(b){a=b},this.$get=[function(){return{items:_.map(a,unitDb.UnitDecorator),contenders:[]}}]}},unitDb.filters={unsafe:["$sce",function(a){return function(b){return a.trustAsHtml(b)}}],"if":function(){return function(a,b){return b?a:void 0}},flatten:function(){return function(a){var b="<br/> ";return angular.isArray(a)?a.join(b):angular.isObject(a)?_.map(a,function(a,b){return angular.isObject(a)?void 0:b+(a===!0?"":": "+a)}).join(b):a}},time:function(){return function(a){function b(a){return("00"+a).slice(-2)}return Math.floor(a%3600/60)+":"+b(Math.floor(a%3600%60))}},round:function(){return function(a,b){var c=Math.pow(10,b||0);return Math.round((a||0)*c)/c}},shorten:function(){return function(a){return a>1e9-1?a/1e9+"G":a>1e6-1?a/1e6+"M":a>999?a/1e3+"k":a}}},unitDb.directives={thumb:[function(){return{restrict:"E",replace:!0,templateUrl:"views/thumb.html"}}],unit:[function(){return{restrict:"E",replace:!0,templateUrl:"views/unit.html",scope:{item:"=content"}}}],viewSwitcher:[function(){return{restrict:"E",replace:!0,templateUrl:"views/viewSwitcher.html"}}],compactView:[function(){return{restrict:"E",replace:!0,templateUrl:"views/compactView.html"}}],tabView:[function(){return{restrict:"E",replace:!0,templateUrl:"views/tabView.html"}}]},unitDb.controllers={homeCtrl:["$scope","$window","$location","data",function(a,b,c,d){a.factions=[],a.kinds=[],a.tech=[],a.index=d.items,a.contenders=d.contenders;var e=function(a,b){var c=a.indexOf(b);c>=0?a=a.splice(c,1):a.push(b)},f=function(a,b){return a.indexOf(b)>=0};a.toggleFaction=function(b){e(a.factions,b)},a.factionSelected=function(b){return f(a.factions,b)},a.toggleKind=function(b){e(a.kinds,b)},a.kindSelected=function(b){return f(a.kinds,b)},a.toggleTech=function(b){e(a.tech,b)},a.techSelected=function(b){return f(a.tech,b)},a.compare=function(b){b.selected=!b.selected;var c=a.contenders.indexOf(b.id);-1===c?a.contenders.push(b.id):a.contenders.splice(c,1)},a.clear=function(){for(var b in a.index)a.index[b].selected&&(a.index[b].selected=!1);a.contenders=[]},a.strain=function(b){return(0===a.factions.length||f(a.factions,b.faction))&&(0===a.kinds.length||f(a.kinds,b.classification))&&(0===a.tech.length||f(a.tech,b.tech))};var g=0,h=null,i=500;a.unitClick=function(d,e){if(e.ctrlKey)b.open("#/"+d.id,"_blank");else{var f=(new Date).getTime();if(h===d&&i>f-g){d.selected||a.compare(d);var j="/"+a.contenders.join(",");a.$apply(c.path(j))}else h=d,g=f,a.compare(d)}}}],compareCtrl:["$scope","$route","$routeParams","$location","data",function(a,b,c,d,e){function f(){var b="";for(var c in a.contenders)c>0&&(b+=","),b+=a.contenders[c].id;return b}function g(c){a.nextUrl=c,a.thisRoute=b.current,d.path(c)}function h(){var b={};for(var c in a.contenders){var d=a.contenders[c];for(var e in d.content){void 0===b[e]&&(b[e]=[]);for(var f in d.content[e]){void 0===b[e][f]&&(b[e][f]={});var g=b[e][f];for(var h in d.content[e][f][1])g[h]=!0}}}a.categories=Object.keys(b),a.subCategories=[];for(var i in a.categories){var j=a.categories[i],k=a.subCategories.length,l=0,m=b[j][l],n=Object.keys(m);for(var o in n){var p=n[o];a.subCategories.push([j,0,l,p])}a.subCategories[k][1]=a.subCategories.length-k}}var i=c.ids.split(",");a.contenders=_.sortBy(_.filter(e.items,function(a){return _.contains(i,a.id)}),function(a){return i.indexOf(a.id)}),a.compareFormat="compact",a.switchCompareFormat=function(b){a.compareFormat=b},a.nextUrl=null,a.thisRoute=null,a.$on("$locationChangeSuccess",function(c,d){d=d.slice(3+d.indexOf("/#/")),a.nextUrl===d&&(b.current=a.thisRoute,a.nextUrl=null,a.thisRoute=null)}),h(),a.moveUnit=function(b,c){var d=a.contenders.slice(),e=a.contenders[c];d.splice(c,1),d.splice(b,0,e),a.contenders=d,g(f())},a.removeUnit=function(b){a.contenders.splice(b,1),0===a.contenders.length?a.$apply(d.path("/")):g(f())}}]};